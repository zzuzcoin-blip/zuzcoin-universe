<script>
// –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
async function showZUZBalance() {
    console.log("üîÑ –û–±–Ω–æ–≤–ª—è—é –±–∞–ª–∞–Ω—Å ZUZ...");
    
    // 1. –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ç–µ–∫—Å—Ç–æ–º "ZUZ Balance:"
    const allSpans = Array.from(document.querySelectorAll('span, div, p'));
    const label = allSpans.find(el => el.textContent && el.textContent.includes('ZUZ Balance'));
    
    if (!label) {
        console.error("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —Ç–µ–∫—Å—Ç 'ZUZ Balance' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ");
        return;
    }
    
    console.log("‚úÖ –ù–∞–π–¥–µ–Ω label:", label.textContent);
    
    // 2. –ù–∞—Ö–æ–¥–∏–º –∏–ª–∏ —Å–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è
    let valueElement = label.nextElementSibling;
    
    if (!valueElement || !valueElement.id) {
        // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è
        valueElement = document.createElement('span');
        valueElement.id = 'zuzBalanceDisplay';
        valueElement.style.fontWeight = 'bold';
        valueElement.style.color = '#10b981';
        valueElement.style.marginLeft = '10px';
        valueElement.style.fontSize = '1.1em';
        
        // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ label
        label.parentNode.insertBefore(valueElement, label.nextSibling);
        console.log("‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞");
    }
    
    // 3. –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å —á–µ—Ä–µ–∑ –Ω–∞—à API
    try {
        const userAddress = window.ethereum?.selectedAddress;
        if (!userAddress) {
            valueElement.textContent = 'Connect Wallet';
            return;
        }
        
        valueElement.innerHTML = '<span class="loader" style="display:inline-block; margin-right:5px;"></span> Loading...';
        
        const response = await fetch('/api/balance/' + userAddress);
        const data = await response.json();
        
        if (data.balanceZUZ) {
            const balance = parseFloat(data.balanceZUZ).toFixed(4);
            valueElement.textContent = `${balance} ZUZ`;
            valueElement.style.color = '#10b981'; // –ó–µ–ª—ë–Ω—ã–π
            console.log(`‚úÖ –ë–∞–ª–∞–Ω—Å –æ—Ç–æ–±—Ä–∞–∂—ë–Ω: ${balance} ZUZ`);
        } else {
            valueElement.textContent = 'Error';
            valueElement.style.color = '#ef4444'; // –ö—Ä–∞—Å–Ω—ã–π
        }
        
    } catch (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞:", error);
        valueElement.textContent = 'Error';
        valueElement.style.color = '#ef4444';
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log("üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞—é –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞...");
    
    // –ñ–¥—ë–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è MetaMask
    if (window.ethereum) {
        setTimeout(showZUZBalance, 1000);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ —Å–º–µ–Ω–µ –∞–∫–∫–∞—É–Ω—Ç–∞
        window.ethereum.on('accountsChanged', showZUZBalance);
    } else {
        console.warn("‚ö†Ô∏è MetaMask –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω");
    }
});

// –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
window.showZUZBalance = showZUZBalance;
console.log("üì¢ –î–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –≤–≤–µ–¥–∏—Ç–µ: showZUZBalance()");
</script>

<style>
.loader {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: #6366f1;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>
