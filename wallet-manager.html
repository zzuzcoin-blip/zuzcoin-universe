<!DOCTYPE html>
<html>
<head>
    <title>ZUZIM - Wallet Manager</title>
    <meta name="viewport" content="width=600, initial-scale=1">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(135deg, #0a0b29 0%, #1a1b3a 100%);
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 560px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        h1 {
            color: #00ff88;
            font-size: 24px;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #aaa;
            font-size: 14px;
        }
        
        .status-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .status-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .status-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(76,175,80,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
        }
        .status-title {
            font-size: 18px;
            font-weight: bold;
        }
        .status-details {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .detail-label {
            color: #aaa;
        }
        .detail-value {
            font-weight: bold;
        }
        
        .action-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        h3 {
            margin-bottom: 15px;
            color: #00ff88;
        }
        
        .wallet-option {
            display: flex;
            align-items: center;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        .wallet-option:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(246,133,27,0.5);
            transform: translateY(-2px);
        }
        .wallet-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(246,133,27,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
        }
        .wallet-info {
            flex-grow: 1;
        }
        .wallet-name {
            font-weight: bold;
            font-size: 16px;
        }
        .wallet-desc {
            font-size: 12px;
            color: #aaa;
            margin-top: 3px;
        }
        
        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        .connect-btn {
            background: linear-gradient(135deg, #F6851B 0%, #E2761B 100%);
            color: white;
        }
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(246,133,27,0.4);
        }
        .disconnect-btn {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: white;
        }
        .disconnect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255,68,68,0.4);
        }
        
        .instructions {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            font-size: 13px;
            color: #aaa;
        }
        .instructions ol {
            margin-left: 20px;
            margin-top: 10px;
        }
        .instructions li {
            margin-bottom: 8px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
            display: none;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîó Wallet Manager</h1>
            <div class="subtitle">Manage your wallet connections</div>
        </header>
        
        <div class="status-card">
            <div class="status-header">
                <div class="status-icon">üìä</div>
                <div class="status-title">Current Status</div>
            </div>
            <div id="statusDisplay">Checking connection...</div>
            <div id="accountDetails" class="status-details" style="display: none;">
                <div class="detail-row">
                    <span class="detail-label">Address:</span>
                    <span class="detail-value" id="currentAddress"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ETH Balance:</span>
                    <span class="detail-value" id="currentEthBalance"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ZUZ Balance:</span>
                    <span class="detail-value" id="currentZuzBalance"></span>
                </div>
            </div>
        </div>
        
        <div class="action-card">
            <h3>Switch Wallet</h3>
            <button class="disconnect-btn" onclick="disconnectWallet()">
                üö™ Disconnect & Connect New Wallet
            </button>
            <p style="text-align: center; margin-top: 10px; font-size: 12px; color: #aaa;">
                This will disconnect current wallet and allow you to connect a different one
            </p>
        </div>
        
        <div class="action-card">
            <h3>Connect Wallet</h3>
            <div class="wallet-option" onclick="connectMetaMask()">
                <div class="wallet-icon">ü¶ä</div>
                <div class="wallet-info">
                    <div class="wallet-name">MetaMask</div>
                    <div class="wallet-desc">Connect to your MetaMask wallet</div>
                </div>
                <div style="color: #00ff88;">‚Üí</div>
            </div>
        </div>
        
        <div class="instructions">
            <strong>How to switch accounts:</strong>
            <ol>
                <li>Click "Disconnect & Connect New Wallet"</li>
                <li>Confirm the disconnection in MetaMask</li>
                <li>Click the MetaMask option above</li>
                <li>MetaMask will open and ask which account to connect</li>
                <li>Select a different account or wallet</li>
            </ol>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>

    <script>
    let currentAccount = null;
    
    // Elements
    const statusDisplay = document.getElementById('statusDisplay');
    const accountDetails = document.getElementById('accountDetails');
    const currentAddressEl = document.getElementById('currentAddress');
    const currentEthBalanceEl = document.getElementById('currentEthBalance');
    const currentZuzBalanceEl = document.getElementById('currentZuzBalance');
    const notification = document.getElementById('notification');
    
    // Show notification
    function showNotification(message, isError = false) {
        notification.textContent = message;
        notification.style.borderLeftColor = isError ? '#ff4444' : '#4CAF50';
        notification.style.display = 'block';
        setTimeout(() => {
            notification.style.display = 'none';
        }, 3000);
    }
    
    // Check current status
    async function checkStatus() {
        if (typeof window.ethereum === 'undefined') {
            statusDisplay.innerHTML = '<span style="color: #ff4444">‚ùå No Web3 wallet detected</span>';
            return;
        }
        
        try {
            const accounts = await window.ethereum.request({ 
                method: 'eth_accounts' 
            });
            
            if (accounts.length > 0) {
                currentAccount = accounts[0];
                
                // Update status
                statusDisplay.innerHTML = '<span style="color: #4CAF50">‚úÖ Connected to MetaMask</span>';
                accountDetails.style.display = 'block';
                
                // Update address
                currentAddressEl.textContent = 
                    currentAccount.substring(0, 6) + '...' + currentAccount.substring(38);
                
                // Get ETH balance
                const ethBalance = await window.ethereum.request({
                    method: 'eth_getBalance',
                    params: [currentAccount, 'latest']
                });
                currentEthBalanceEl.textContent = (parseInt(ethBalance) / 1e18).toFixed(4) + ' ETH';
                
                // Get ZUZ balance
                try {
                    if (typeof ethers !== 'undefined') {
                        const provider = new ethers.BrowserProvider(window.ethereum);
                        const zuzContract = new ethers.Contract(
                            '0x4284ecC7E6E560cAfc0bA65CbDFc9c19bd2C0bD3',
                            ['function balanceOf(address) view returns (uint256)'],
                            provider
                        );
                        const zuzBalance = await zuzContract.balanceOf(currentAccount);
                        currentZuzBalanceEl.textContent = (parseInt(zuzBalance) / 1e18).toFixed(0) + ' ZUZ';
                    }
                } catch (zuzError) {
                    currentZuzBalanceEl.textContent = 'Check MetaMask';
                }
                
            } else {
                statusDisplay.innerHTML = '<span style="color: #ff9800">‚ö†Ô∏è Not connected to any wallet</span>';
                accountDetails.style.display = 'none';
                currentAccount = null;
            }
            
        } catch (error) {
            statusDisplay.innerHTML = `<span style="color: #ff4444">‚ùå Error: ${error.message}</span>`;
            accountDetails.style.display = 'none';
        }
    }
    
    // Connect MetaMask
    async function connectMetaMask() {
        if (typeof window.ethereum === 'undefined') {
            showNotification('Please install MetaMask first!', true);
            window.open('https://metamask.io/download/', '_blank');
            return;
        }
        
        try {
            // THIS WILL SHOW METAMASK POPUP!
            const accounts = await window.ethereum.request({
                method: 'eth_requestAccounts'
            });
            
            if (accounts.length > 0) {
                showNotification(`‚úÖ Connected: ${accounts[0].substring(0,6)}...${accounts[0].substring(38)}`);
                setTimeout(() => {
                    checkStatus();
                }, 1000);
            }
        } catch (error) {
            showNotification(`‚ùå Error: ${error.message}`, true);
        }
    }
    
    // Disconnect wallet
    async function disconnectWallet() {
        if (!currentAccount) {
            showNotification('No wallet connected to disconnect', true);
            return;
        }
        
        try {
            // Ask MetaMask to disconnect
            await window.ethereum.request({
                method: 'wallet_revokePermissions',
                params: [{
                    eth_accounts: {}
                }]
            });
            
            showNotification('‚úÖ Disconnected. You can now connect a different wallet.');
            setTimeout(() => {
                checkStatus();
            }, 1500);
            
        } catch (error) {
            console.log('Could not revoke permissions:', error);
            showNotification('‚úÖ Local connection cleared');
            currentAccount = null;
            checkStatus();
        }
    }
    
    // Initialize
    checkStatus();
    // Auto-refresh every 5 seconds
    setInterval(checkStatus, 5000);
    
    // Listen for account changes from other windows
    if (window.ethereum) {
        window.ethereum.on('accountsChanged', () => {
            checkStatus();
        });
    }
    </script>
</body>
</html>