<!DOCTYPE html>
<html>
<head>
    <title>FINAL ZUZ Balance Test</title>
    <style>
        body { font-family: Arial; background: #0f172a; color: white; padding: 20px; }
        .test-result { 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 8px; 
            background: #1e293b; 
        }
        .success { border-left: 5px solid #10B981; }
        .fail { border-left: 5px solid #EF4444; }
        button { 
            background: #2d6df6; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            margin: 10px; 
            cursor: pointer; 
        }
    </style>
</head>
<body>
    <h1>üéØ FINAL ZUZ Balance Test</h1>
    
    <div class="test-result" id="test1">
        <h3>Test 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ API</h3>
        <div id="apiResult">–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...</div>
    </div>
    
    <div class="test-result" id="test2">
        <h3>Test 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞</h3>
        <div id="contractResult">–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...</div>
    </div>
    
    <div class="test-result" id="test3">
        <h3>Test 3: –í–∞—à –±–∞–ª–∞–Ω—Å ZUZ</h3>
        <div id="balanceResult" style="font-size: 32px; color: #2d6df6;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <button onclick="checkMyBalance()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–π –±–∞–ª–∞–Ω—Å</button>
    </div>
    
    <div id="debugInfo"></div>
    
    <script>
        const ZUZ_TOKEN_ADDRESS = "0x4284ecC7E6E560cAfc0bA65CbDFc9c19bd2C0bD3";
        
        // Test 1: API
        fetch('/api/status')
            .then(r => r.json())
            .then(data => {
                const el = document.getElementById('apiResult');
                el.innerHTML = `<strong>‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç!</strong><br>
                    Status: ${data.status}<br>
                    Contract: ${data.tokenContract}<br>
                    Network: ${data.network}`;
                document.getElementById('test1').classList.add('success');
            })
            .catch(err => {
                document.getElementById('apiResult').textContent = '‚ùå API –æ—à–∏–±–∫–∞: ' + err.message;
                document.getElementById('test1').classList.add('fail');
            });
        
        // Test 2: Contract info
        fetch('/api/token-info')
            .then(r => r.json())
            .then(data => {
                const el = document.getElementById('contractResult');
                const supply = (parseInt(data.totalSupply) / 1e18).toLocaleString();
                el.innerHTML = `<strong>‚úÖ –ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–∞–π–¥–µ–Ω!</strong><br>
                    Name: ${data.name}<br>
                    Symbol: ${data.symbol}<br>
                    Total Supply: ${supply} ${data.symbol}<br>
                    Address: ${data.address}`;
                document.getElementById('test2').classList.add('success');
            })
            .catch(err => {
                document.getElementById('contractResult').textContent = '‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞: ' + err.message;
                document.getElementById('test2').classList.add('fail');
            });
        
        // Test 3: User balance
        async function checkMyBalance() {
            if (typeof window.ethereum === 'undefined') {
                document.getElementById('balanceResult').textContent = 'MetaMask –Ω–µ –Ω–∞–π–¥–µ–Ω';
                document.getElementById('test3').classList.add('fail');
                return;
            }
            
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const address = accounts[0];
                
                const response = await fetch(`/api/balance/${address}`);
                const data = await response.json();
                
                const formatted = parseFloat(data.formatted).toLocaleString();
                document.getElementById('balanceResult').innerHTML = 
                    `<strong>${formatted} ZUZ</strong>`;
                
                document.getElementById('debugInfo').innerHTML = `
                    <div class="test-result success">
                        <strong>üéâ –£–°–ü–ï–•!</strong><br>
                        –í–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: ${formatted} ZUZ<br>
                        –ê–¥—Ä–µ—Å: ${address}<br>
                        –ö–æ–Ω—Ç—Ä–∞–∫—Ç: ${data.tokenAddress}<br>
                        <strong>–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ 10,000,000 ZUZ - –í–°–Å –†–ê–ë–û–¢–ê–ï–¢!</strong>
                    </div>
                `;
                
                document.getElementById('test3').classList.add('success');
            } catch (error) {
                document.getElementById('balanceResult').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                document.getElementById('test3').classList.add('fail');
            }
        }
        
        // –ê–≤—Ç–æ-–ø—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å–ª–∏ MetaMask —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
        if (typeof window.ethereum !== 'undefined' && window.ethereum.selectedAddress) {
            setTimeout(checkMyBalance, 1000);
        }
    </script>
</body>
</html>
