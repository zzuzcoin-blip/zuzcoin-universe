const express = require('express');
const app = express();
const port = 3000;

app.use(express.json());

// CORS Ğ´Ğ»Ñ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°
app.use((req, res, next) => {
    res.header('Access-Control-Allow-Origin', '*');
    res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept');
    next();
});

// Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°
app.get('/', (req, res) => {
    res.sendFile(__dirname + '/index.html');
});

// API ÑÑ‚Ğ°Ñ‚ÑƒÑ
app.get('/api/status', (req, res) => {
    res.json({
        status: "online",
        ecosystem: "ZUZCOIN Universe v3.0",
        network: "Sepolia Testnet",
        chainId: 11155111,
        contract: "0x5B9d42EcAf7498771cC4edF728d3Dc3cc1f87C31",
        contract_explorer: "https://sepolia.etherscan.io/address/0x5B9d42EcAf7498771cC4edF728d3Dc3cc1f87C31",
        features: ["ZUZCOIN Token (real contract)", "ZUZIM DEX (coming soon)", "Token Factory", "Digital Notary", "KYC Verification", "1% Auto-Philanthropy"],
        timestamp: new Date().toISOString()
    });
});

// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ° Ñ‡ĞµÑ€ĞµĞ· API (Ğ°Ğ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ¼ĞµÑ‚Ğ¾Ğ´)
app.get('/api/balance/:address', async (req, res) => {
    try {
        const ethers = require('ethers');
        const provider = new ethers.providers.JsonRpcProvider("https://ethereum-sepolia.publicnode.com");
        const contract = new ethers.Contract(
            "0x5B9d42EcAf7498771cC4edF728d3Dc3cc1f87C31",
            ["function balanceOf(address) view returns (uint256)"],
            provider
        );
        const balance = await contract.balanceOf(req.params.address);
        res.json({
            address: req.params.address,
            balanceWei: balance.toString(),
            balanceZUZ: ethers.utils.formatUnits(balance, 18),
            timestamp: new Date().toISOString()
        });
    } catch (err) {
        res.status(500).json({ error: err.message });
    }
});

// Ğ¡Ñ‚Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
app.use(express.static(__dirname));

app.listen(port, () => {
    console.log(`ğŸš€ ZUZCOIN Universe ÑĞµÑ€Ğ²ĞµÑ€ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½ Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ ${port}`);
    console.log(`ğŸŒ Ğ¡ĞµÑ‚ÑŒ: Sepolia Testnet`);
    console.log(`ğŸ“ ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚: 0x5B9d42EcAf7498771cC4edF728d3Dc3cc1f87C31`);
    console.log(`ğŸ”„ API ÑÑ‚Ğ°Ñ‚ÑƒÑ: http://localhost:${port}/api/status`);
});
