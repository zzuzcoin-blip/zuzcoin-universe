<script>
// ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –¢–û–ö–ï–ù–ê ZUZCOIN =====
const ZUZCOIN_CONTRACT = "0x5B9d42EcAf7498771cC4edF728d3Dc3cc1f87C31";
// =======================================

async function updateZuzBalanceInUI() {
    console.log("üîÑ –û–±–Ω–æ–≤–ª—è—é –±–∞–ª–∞–Ω—Å ZUZ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ...");
    const balanceElement = document.getElementById('tokenBalance');
    if (!balanceElement) {
        console.error("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞!");
        return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–∫–ª—é—á–µ–Ω –ª–∏ –∫–æ—à–µ–ª–µ–∫
    if (!window.ethereum || !window.ethereum.selectedAddress) {
        balanceElement.textContent = '0.0000 ZUZ';
        return;
    }

    const userAddress = window.ethereum.selectedAddress;
    console.log("üë§ –ê–¥—Ä–µ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:", userAddress);

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    balanceElement.innerHTML = '<span class="loader" style="margin-right: 8px;"></span> Loading...';

    try {
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º ethers –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const contractABI = [
            "function balanceOf(address owner) view returns (uint256)",
            "function symbol() view returns (string)"
        ];
        const contract = new ethers.Contract(ZUZCOIN_CONTRACT, contractABI, provider);

        // –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å –∏ —Å–∏–º–≤–æ–ª
        const [rawBalance, symbol] = await Promise.all([
            contract.balanceOf(userAddress),
            contract.symbol()
        ]);

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –±–∞–ª–∞–Ω—Å (18 decimals —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ –¥–ª—è ERC-20)
        const formattedBalance = ethers.utils.formatUnits(rawBalance, 18);
        const displayBalance = parseFloat(formattedBalance).toFixed(4);
        
        console.log("‚úÖ –ë–∞–ª–∞–Ω—Å –ø–æ–ª—É—á–µ–Ω:", displayBalance, symbol);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        balanceElement.textContent = `${displayBalance} ${symbol}`;
        balanceElement.style.color = "#10b981"; // –ó–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è —É—Å–ø–µ—Ö–∞
        
    } catch (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞:", error);
        balanceElement.textContent = 'Error';
        balanceElement.style.color = "#ef4444"; // –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –æ—à–∏–±–∫–∏
    }
}

// –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –ó–ê–ü–£–°–ö –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
document.addEventListener('DOMContentLoaded', function() {
    console.log("üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∑–∞–ø—É—Å–∫–∞—é –ø—Ä–æ–≤–µ—Ä–∫—É –±–∞–ª–∞–Ω—Å–∞...");
    
    // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ ethers –∏ MetaMask
    setTimeout(() => {
        if (typeof ethers !== 'undefined' && window.ethereum) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å —Å—Ä–∞–∑—É
            updateZuzBalanceInUI();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ —Å–º–µ–Ω–µ –∞–∫–∫–∞—É–Ω—Ç–∞
            window.ethereum.on('accountsChanged', updateZuzBalanceInUI);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–µ—Ç–∏
            window.ethereum.on('chainChanged', () => {
                setTimeout(updateZuzBalanceInUI, 1000);
            });
        } else {
            console.warn("‚ö†Ô∏è Ethers –∏–ª–∏ MetaMask –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã");
        }
    }, 1000);
});

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ –∫–æ–Ω—Å–æ–ª–∏)
window.updateZuzBalance = updateZuzBalanceInUI;
</script>
