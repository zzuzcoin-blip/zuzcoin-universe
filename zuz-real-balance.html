<!DOCTYPE html>
<html>
<head>
    <title>ZUZIM Universe - Real Balance</title>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body { font-family: Arial; background: #0f172a; color: white; padding: 20px; }
        .balance { 
            font-size: 60px; 
            color: #2d6df6; 
            margin: 30px 0;
            text-shadow: 0 0 10px rgba(45, 109, 246, 0.5);
        }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: #1e293b; padding: 20px; border-radius: 10px; margin: 20px 0; }
        button { 
            background: #2d6df6; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 8px; 
            font-size: 16px; 
            cursor: pointer; 
            margin: 10px; 
        }
        button:hover { background: #1e4fd8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ ZUZIM Universe - Real Token Balance</h1>
        <p>–í–µ—Ä—Å–∏—è —Å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫—ç—à–∞</p>
        
        <div class="card">
            <h2>–í–∞—à –±–∞–ª–∞–Ω—Å ZUZ:</h2>
            <div class="balance" id="balanceDisplay">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <button onclick="checkBalance()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
            <button onclick="connectMetaMask()">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask</button>
        </div>
        
        <div class="card">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ:</h2>
            <div id="contractInfo">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div class="card">
            <h2>–û—Ç–ª–∞–¥–∫–∞:</h2>
            <div id="debugInfo"></div>
        </div>
    </div>
    
    <script>
        // –í–µ—Ä—Å–∏—è —Å –º–µ—Ç–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –∫—ç—à–∞
        const VERSION = Date.now();
        const ZUZ_TOKEN_ADDRESS = "0x4284ecC7E6E560cAfc0bA65CbDFc9c19bd2C0bD3";
        
        console.log('ZUZIM Universe - Real Balance v' + VERSION);
        console.log('Token Address:', ZUZ_TOKEN_ADDRESS);
        
        async function loadContractInfo() {
            try {
                const response = await fetch('/api/token-info?_=' + VERSION);
                const data = await response.json();
                
                document.getElementById('contractInfo').innerHTML = `
                    <strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> ${data.name}<br>
                    <strong>–°–∏–º–≤–æ–ª:</strong> ${data.symbol}<br>
                    <strong>–ê–¥—Ä–µ—Å:</strong> ${data.address}<br>
                    <strong>Total Supply:</strong> ${(parseInt(data.totalSupply) / 1e18).toLocaleString()} ${data.symbol}<br>
                    <strong>–°–µ—Ç—å:</strong> ${data.network}<br>
                    <a href="${data.etherscanUrl}" target="_blank">üîó –û—Ç–∫—Ä—ã—Ç—å –Ω–∞ Etherscan</a>
                `;
                
                return data;
            } catch (error) {
                document.getElementById('debugInfo').innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞: ' + error.message;
            }
        }
        
        async function checkBalance() {
            document.getElementById('balanceDisplay').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            const contractInfo = await loadContractInfo();
            
            if (typeof window.ethereum !== 'undefined' && window.ethereum.selectedAddress) {
                const address = window.ethereum.selectedAddress;
                try {
                    const response = await fetch(`/api/balance/${address}?_=` + VERSION);
                    const data = await response.json();
                    
                    const formattedBalance = parseFloat(data.formatted).toLocaleString();
                    document.getElementById('balanceDisplay').textContent = formattedBalance + ' ZUZ';
                    
                    document.getElementById('debugInfo').innerHTML = `
                        <strong>–£—Å–ø–µ—à–Ω–æ!</strong><br>
                        –ö–æ—à–µ–ª–µ–∫: ${address}<br>
                        –ë–∞–ª–∞–Ω—Å: ${data.balance} wei<br>
                        –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π: ${data.formatted} ZUZ<br>
                        –ö–æ–Ω—Ç—Ä–∞–∫—Ç: ${data.tokenAddress}
                    `;
                } catch (error) {
                    document.getElementById('balanceDisplay').textContent = '–û—à–∏–±–∫–∞';
                    document.getElementById('debugInfo').textContent = '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞: ' + error.message;
                }
            } else {
                document.getElementById('balanceDisplay').textContent = 'MetaMask –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω';
                document.getElementById('debugInfo').textContent = '–ü–æ–¥–∫–ª—é—á–∏—Ç–µ MetaMask –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞';
            }
        }
        
        async function connectMetaMask() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    document.getElementById('debugInfo').innerHTML = '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ: ' + accounts[0];
                    checkBalance();
                } catch (error) {
                    document.getElementById('debugInfo').textContent = '‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message;
                }
            } else {
                document.getElementById('debugInfo').textContent = '‚ùå MetaMask –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω!';
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadContractInfo();
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ MetaMask —É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω
        if (typeof window.ethereum !== 'undefined' && window.ethereum.selectedAddress) {
            setTimeout(checkBalance, 1000);
        }
    </script>
</body>
</html>
