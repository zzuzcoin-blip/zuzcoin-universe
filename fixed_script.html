<script>
// ===== –û–°–ù–û–í–ù–û–ô –°–ö–†–ò–ü–¢ –î–õ–Ø –ë–ê–õ–ê–ù–°–ê ZUZCOIN =====
async function updateZuzBalanceInUI() {
    console.log("üîÑ –û–±–Ω–æ–≤–ª—è—é –±–∞–ª–∞–Ω—Å ZUZ...");
    
    // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ ID —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    const balanceElement = document.getElementById('tokenBalance') || 
                          document.getElementById('zuzBalance') ||
                          document.querySelector('[class*="balance"][class*="zuz"]') ||
                          document.querySelector('span:contains("ZUZ")');
    
    if (!balanceElement) {
        console.error("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω —ç–ª–µ–º–µ–Ω—Ç –±–∞–ª–∞–Ω—Å–∞. –ò—â–µ–º –≤—Ä—É—á–Ω—É—é...");
        // –ü–æ—Å–º–æ—Ç—Ä–∏–º –≤—Å—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ—à–µ–ª—å–∫–∞
        const walletCard = document.querySelector('.card:contains("My Wallet")');
        if (walletCard) console.log("–ù–∞–π–¥–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–æ—à–µ–ª—å–∫–∞:", walletCard.innerHTML);
        return;
    }

    if (!window.ethereum?.selectedAddress) {
        balanceElement.textContent = '0.0000 ZUZ';
        return;
    }

    const userAddress = window.ethereum.selectedAddress;
    balanceElement.innerHTML = '<span class="loader"></span> Loading...';

    try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const contract = new ethers.Contract(
            "0x5B9d42EcAf7498771cC4edF728d3Dc3cc1f87C31",
            ["function balanceOf(address) view returns (uint256)", "function symbol() view returns (string)"],
            provider
        );

        const [rawBalance, symbol] = await Promise.all([
            contract.balanceOf(userAddress),
            contract.symbol()
        ]);

        const formatted = ethers.utils.formatUnits(rawBalance, 18);
        balanceElement.textContent = `${parseFloat(formatted).toFixed(4)} ${symbol}`;
        console.log(`‚úÖ –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—ë–Ω: ${parseFloat(formatted).toFixed(4)} ${symbol}`);
        
    } catch (error) {
        console.error("‚ùå –û—à–∏–±–∫–∞:", error.message);
        balanceElement.textContent = 'Error';
    }
}

// –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
if (typeof ethers !== 'undefined' && window.ethereum) {
    // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(updateZuzBalanceInUI, 1000);
        });
    } else {
        setTimeout(updateZuzBalanceInUI, 1000);
    }
    
    // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è MetaMask
    window.ethereum.on('accountsChanged', updateZuzBalanceInUI);
    window.ethereum.on('chainChanged', () => setTimeout(updateZuzBalanceInUI, 1000));
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
window.updateZUZ = updateZuzBalanceInUI;
console.log("üöÄ –°–∫—Ä–∏–ø—Ç –±–∞–ª–∞–Ω—Å–∞ ZUZCOIN –∑–∞–≥—Ä—É–∂–µ–Ω. –î–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ: updateZUZ()");
</script>
