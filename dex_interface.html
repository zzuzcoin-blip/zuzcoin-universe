<!DOCTYPE html>
<html>
<head>
    <title>ZUZIM DEX Interface</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { border: 1px solid #ccc; padding: 20px; margin: 20px 0; border-radius: 10px; }
        button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #45a049; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ZUZIM DEX Interface</h1>
    
    <div class="section">
        <h2>1. Подключение кошелька</h2>
        <button onclick="connectWallet()">Connect MetaMask</button>
        <p id="walletStatus">Не подключен</p>
    </div>
    
    <div class="section">
        <h2>2. Создание пары ZUZ/USDT</h2>
        <p><strong>ZUZ Token:</strong> 0x4284ecC7E6E560cAfc0bA65CbDFc9c19bd2C0bD3</p>
        <p><strong>USDT (Sepolia):</strong> 0x7169D38820dfd117C3FA1f22a697dBA58d90BA06</p>
        <button onclick="createPair()">Create ZUZ/USDT Pair</button>
        <p id="pairStatus"></p>
    </div>
    
    <div class="section">
        <h2>3. Добавление ликвидности</h2>
        <p>ZUZ Amount: <input type="number" id="zuzAmount" value="1000"></p>
        <p>USDT Amount: <input type="number" id="usdtAmount" value="500"></p>
        <button onclick="addLiquidity()">Add Liquidity</button>
        <p id="liquidityStatus"></p>
    </div>
    
    <div class="section">
        <h2>4. Обмен токенов</h2>
        <p>Amount to swap: <input type="number" id="swapAmount" value="100"></p>
        <button onclick="swapZUZtoUSDT()">Swap ZUZ → USDT</button>
        <button onclick="swapUSDTtoZUZ()">Swap USDT → ZUZ</button>
        <p id="swapStatus"></p>
    </div>

    <script>
        // Контрактные адреса
        const DEX_ADDRESS = "0x09970975aa48c718e17db4a18128ebf6806e1f2c";
        const ZUZ_TOKEN = "0x4284ecC7E6E560cAfc0bA65CbDFc9c19bd2C0bD3";
        const USDT_TOKEN = "0x7169D38820dfd117C3FA1f22a697dBA58d90BA06";
        
        // ABI для DEX
        const DEX_ABI = [
            "function createPair(address tokenA, address tokenB) external",
            "function addLiquidity(address tokenA, address tokenB, uint256 amountA, uint256 amountB) external",
            "function swap(address tokenIn, address tokenOut, uint256 amountIn) external returns (uint256)",
            "function getSwapQuote(address tokenIn, address tokenOut, uint256 amountIn) external view returns (uint256 amountOut, uint256 charityAmount)",
            "function owner() external view returns (address)",
            "function charityWallet() external view returns (address)"
        ];
        
        // ABI для ERC20
        const ERC20_ABI = [
            "function approve(address spender, uint256 amount) external returns (bool)",
            "function balanceOf(address account) external view returns (uint256)",
            "function decimals() external view returns (uint8)"
        ];
        
        let provider, signer, dexContract, userAddress;
        
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                alert("Установите MetaMask!");
                return;
            }
            
            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();
                
                dexContract = new ethers.Contract(DEX_ADDRESS, DEX_ABI, signer);
                
                document.getElementById('walletStatus').innerHTML = 
                    `<span class="success">✅ Подключен: ${userAddress.substring(0, 10)}...</span>`;
                
                // Проверяем владельца DEX
                const owner = await dexContract.owner();
                const isOwner = owner.toLowerCase() === userAddress.toLowerCase();
                
                if (isOwner) {
                    document.getElementById('pairStatus').innerHTML = 
                        "<span class='success'>✅ Вы владелец DEX, можете создавать пары</span>";
                } else {
                    document.getElementById('pairStatus').innerHTML = 
                        "<span class='error'>❌ Вы не владелец DEX</span>";
                }
                
            } catch (error) {
                document.getElementById('walletStatus').innerHTML = 
                    `<span class="error">❌ Ошибка: ${error.message}</span>`;
            }
        }
        
        async function createPair() {
            if (!signer) {
                alert("Сначала подключите кошелек");
                return;
            }
            
            try {
                document.getElementById('pairStatus').innerHTML = "⏳ Создаю пару...";
                
                const tx = await dexContract.createPair(ZUZ_TOKEN, USDT_TOKEN);
                document.getElementById('pairStatus').innerHTML = 
                    `⏳ Транзакция отправлена: ${tx.hash}`;
                
                await tx.wait();
                document.getElementById('pairStatus').innerHTML = 
                    `<span class="success">✅ Пара ZUZ/USDT создана успешно!</span>`;
                
            } catch (error) {
                document.getElementById('pairStatus').innerHTML = 
                    `<span class="error">❌ Ошибка: ${error.message}</span>`;
            }
        }
        
        async function addLiquidity() {
            if (!signer) {
                alert("Сначала подключите кошелек");
                return;
            }
            
            try {
                const zuzAmount = document.getElementById('zuzAmount').value;
                const usdtAmount = document.getElementById('usdtAmount').value;
                
                if (!zuzAmount || !usdtAmount) {
                    alert("Введите суммы");
                    return;
                }
                
                document.getElementById('liquidityStatus').innerHTML = "⏳ Добавляю ликвидность...";
                
                // Получаем контракты токенов
                const zuzContract = new ethers.Contract(ZUZ_TOKEN, ERC20_ABI, signer);
                const usdtContract = new ethers.Contract(USDT_TOKEN, ERC20_ABI, signer);
                
                // Аппруваем DEX тратить наши токены
                const zuzDecimals = await zuzContract.decimals();
                const usdtDecimals = await usdtContract.decimals();
                
                const zuzAmountWei = ethers.utils.parseUnits(zuzAmount, zuzDecimals);
                const usdtAmountWei = ethers.utils.parseUnits(usdtAmount, usdtDecimals);
                
                const approveZuz = await zuzContract.approve(DEX_ADDRESS, zuzAmountWei);
                await approveZuz.wait();
                
                const approveUsdt = await usdtContract.approve(DEX_ADDRESS, usdtAmountWei);
                await approveUsdt.wait();
                
                // Добавляем ликвидность
                const tx = await dexContract.addLiquidity(
                    ZUZ_TOKEN,
                    USDT_TOKEN,
                    zuzAmountWei,
                    usdtAmountWei
                );
                
                document.getElementById('liquidityStatus').innerHTML = 
                    `⏳ Транзакция отправлена: ${tx.hash}`;
                
                await tx.wait();
                document.getElementById('liquidityStatus').innerHTML = 
                    `<span class="success">✅ Ликвидность добавлена!</span>`;
                
            } catch (error) {
                document.getElementById('liquidityStatus').innerHTML = 
                    `<span class="error">❌ Ошибка: ${error.message}</span>`;
            }
        }
        
        async function swapZUZtoUSDT() {
            await swapTokens(ZUZ_TOKEN, USDT_TOKEN, 'swapAmount', 'swapStatus');
        }
        
        async function swapUSDTtoZUZ() {
            await swapTokens(USDT_TOKEN, ZUZ_TOKEN, 'swapAmount', 'swapStatus');
        }
        
        async function swapTokens(tokenIn, tokenOut, amountId, statusId) {
            if (!signer) {
                alert("Сначала подключите кошелек");
                return;
            }
            
            try {
                const amount = document.getElementById(amountId).value;
                if (!amount) {
                    alert("Введите сумму");
                    return;
                }
                
                document.getElementById(statusId).innerHTML = "⏳ Выполняю обмен...";
                
                const tokenContract = new ethers.Contract(tokenIn, ERC20_ABI, signer);
                const decimals = await tokenContract.decimals();
                const amountWei = ethers.utils.parseUnits(amount, decimals);
                
                // Аппруваем DEX тратить токены
                const approveTx = await tokenContract.approve(DEX_ADDRESS, amountWei);
                await approveTx.wait();
                
                // Получаем котировку
                const [quoteAmount, charityAmount] = await dexContract.getSwapQuote(
                    tokenIn,
                    tokenOut,
                    amountWei
                );
                
                const quoteFormatted = ethers.utils.formatUnits(quoteAmount, decimals);
                const charityFormatted = ethers.utils.formatUnits(charityAmount, decimals);
                
                // Выполняем обмен
                const swapTx = await dexContract.swap(tokenIn, tokenOut, amountWei);
                document.getElementById(statusId).innerHTML = 
                    `⏳ Обмен: ${amount} → ${quoteFormatted} (донат: ${charityFormatted})`;
                
                await swapTx.wait();
                document.getElementById(statusId).innerHTML = 
                    `<span class="success">✅ Обмен выполнен! 1% отправлен на благотворительность</span>`;
                
            } catch (error) {
                document.getElementById(statusId).innerHTML = 
                    `<span class="error">❌ Ошибка: ${error.message}</span>`;
            }
        }
        
        // Автоподключение при загрузке
        window.addEventListener('load', () => {
            if (typeof window.ethereum !== 'undefined' && window.ethereum.selectedAddress) {
                connectWallet();
            }
        });
    </script>
</body>
</html>
